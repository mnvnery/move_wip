/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
export class BufferManager {
    constructor(device) {
        this.device = device;
        this.numUsedBuffers = 0;
        this.numFreeBuffers = 0;
        this.freeBuffers = new Map();
        this.usedBuffers = new Map();
        this.numBytesUsed = 0;
        this.numBytesAllocated = 0;
    }
    acquireUploadBuffer(size, usage) {
        return this.acquireBuffer(size, usage, true);
    }
    acquireBuffer(size, usage, mappedAtCreation = false) {
        const key = getBufferKey(size, usage);
        if (!this.freeBuffers.has(key)) {
            this.freeBuffers.set(key, []);
        }
        if (!this.usedBuffers.has(key)) {
            this.usedBuffers.set(key, []);
        }
        this.numBytesUsed += size;
        this.numUsedBuffers++;
        if (this.freeBuffers.get(key).length > 0) {
            this.numFreeBuffers--;
            const newBuffer = this.freeBuffers.get(key).shift();
            this.usedBuffers.get(key).push(newBuffer);
            return newBuffer;
        }
        this.numBytesAllocated += size;
        const newBuffer = this.device.createBuffer({ size, usage, mappedAtCreation });
        this.usedBuffers.get(key).push(newBuffer);
        return newBuffer;
    }
    releaseBuffer(buffer, size, usage) {
        if (this.freeBuffers.size === 0) {
            return;
        }
        const key = getBufferKey(size, usage);
        if (!this.freeBuffers.has(key)) {
            this.freeBuffers.set(key, []);
        }
        this.freeBuffers.get(key).push(buffer);
        this.numFreeBuffers++;
        this.numUsedBuffers--;
        const bufferList = this.usedBuffers.get(key);
        const bufferIndex = bufferList.indexOf(buffer);
        if (bufferIndex < 0) {
            throw new Error('Cannot release a buffer that was never provided by this ' +
                'buffer manager');
        }
        bufferList.splice(bufferIndex, 1);
        this.numBytesUsed -= size;
    }
    releaseUploadBuffer(buffer, size, usage) {
        buffer.mapAsync(GPUMapMode.WRITE)
            .then(() => {
            this.releaseBuffer(buffer, size, usage);
        }, (err) => {
            // Do nothing;
        });
    }
    getNumUsedBuffers() {
        return this.numUsedBuffers;
    }
    getNumFreeBuffers() {
        return this.numFreeBuffers;
    }
    dispose() {
        this.freeBuffers.forEach((buffers, key) => {
            buffers.forEach(buffer => {
                buffer.destroy();
            });
        });
        this.usedBuffers.forEach((buffers, key) => {
            buffers.forEach(buffer => {
                buffer.destroy();
            });
        });
        this.freeBuffers = new Map();
        this.usedBuffers = new Map();
        this.numUsedBuffers = 0;
        this.numFreeBuffers = 0;
        this.numBytesUsed = 0;
        this.numBytesAllocated = 0;
    }
}
function getBufferKey(size, usage) {
    return `${size}_${usage}`;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVmZmVyX21hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi90ZmpzLWJhY2tlbmQtd2ViZ3B1L3NyYy9idWZmZXJfbWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFFSCxNQUFNLE9BQU8sYUFBYTtJQVN4QixZQUFvQixNQUFpQjtRQUFqQixXQUFNLEdBQU4sTUFBTSxDQUFXO1FBUjdCLG1CQUFjLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLG1CQUFjLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLGdCQUFXLEdBQTZCLElBQUksR0FBRyxFQUFFLENBQUM7UUFDbEQsZ0JBQVcsR0FBNkIsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUVuRCxpQkFBWSxHQUFHLENBQUMsQ0FBQztRQUNqQixzQkFBaUIsR0FBRyxDQUFDLENBQUM7SUFFVyxDQUFDO0lBRXpDLG1CQUFtQixDQUFDLElBQVksRUFBRSxLQUEwQjtRQUMxRCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRUQsYUFBYSxDQUNULElBQVksRUFBRSxLQUEwQixFQUFFLGdCQUFnQixHQUFHLEtBQUs7UUFDcEUsTUFBTSxHQUFHLEdBQUcsWUFBWSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDOUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1NBQy9CO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQzlCLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FB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T0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO2dCQUN2QixNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDbkIsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxFQUFFO1lBQ3hDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ3ZCLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNuQixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztRQUN0QixJQUFJLENBQUMsaUJBQWlCLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLENBQUM7Q0FDRjtBQUVELFNBQVMsWUFBWSxDQUFDLElBQVksRUFBRSxLQUEwQjtJQUM1RCxPQUFPLEdBQUcsSUFBSSxJQUFJLEtBQUssRUFBRSxDQUFDO0FBQzVCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICovXG5cbmV4cG9ydCBjbGFzcyBCdWZmZXJNYW5hZ2VyIHtcbiAgcHJpdmF0ZSBudW1Vc2VkQnVmZmVycyA9IDA7XG4gIHByaXZhdGUgbnVtRnJlZUJ1ZmZlcnMgPSAwO1xuICBwcml2YXRlIGZyZWVCdWZmZXJzOiBNYXA8c3RyaW5nLCBHUFVCdWZmZXJbXT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgdXNlZEJ1ZmZlcnM6IE1hcDxzdHJpbmcsIEdQVUJ1ZmZlcltdPiA9IG5ldyBNYXAoKTtcblxuICBwdWJsaWMgbnVtQnl0ZXNVc2VkID0gMDtcbiAgcHVibGljIG51bUJ5dGVzQWxsb2NhdGVkID0gMDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRldmljZTogR1BVRGV2aWNlKSB7fVxuXG4gIGFjcXVpcmVVcGxvYWRCdWZmZXIoc2l6ZTogbnVtYmVyLCB1c2FnZTogR1BVQnVmZmVyVXNhZ2VGbGFncykge1xuICAgIHJldHVybiB0aGlzLmFjcXVpcmVCdWZmZXIoc2l6ZSwgdXNhZ2UsIHRydWUpO1xuICB9XG5cbiAgYWNxdWlyZUJ1ZmZlcihcbiAgICAgIHNpemU6IG51bWJlciwgdXNhZ2U6IEdQVUJ1ZmZlclVzYWdlRmxhZ3MsIG1hcHBlZEF0Q3JlYXRpb24gPSBmYWxzZSkge1xuICAgIGNvbnN0IGtleSA9IGdldEJ1ZmZlcktleShzaXplLCB1c2FnZSk7XG4gICAgaWYgKCF0aGlzLmZyZWVCdWZmZXJzLmhhcyhrZXkpKSB7XG4gICAgICB0aGlzLmZyZWVCdWZmZXJzLnNldChrZXksIFtdKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMudXNlZEJ1ZmZlcnMuaGFzKGtleSkpIHtcbiAgICAgIHRoaXMudXNlZEJ1ZmZlcnMuc2V0KGtleSwgW10pO1xuICAgIH1cblxuICAgIHRoaXMubnVtQnl0ZXNVc2VkICs9IHNpemU7XG4gICAgdGhpcy5udW1Vc2VkQnVmZmVycysrO1xuXG4gICAgaWYgKHRoaXMuZnJlZUJ1ZmZlcnMuZ2V0KGtleSkubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5udW1GcmVlQnVmZmVycy0tO1xuXG4gICAgICBjb25zdCBuZXdCdWZmZXIgPSB0aGlzLmZyZWVCdWZmZXJzLmdldChrZXkpLnNoaWZ0KCk7XG4gICAgICB0aGlzLnVzZWRCdWZmZXJzLmdldChrZXkpLnB1c2gobmV3QnVmZmVyKTtcbiAgICAgIHJldHVybiBuZXdCdWZmZXI7XG4gICAgfVxuXG4gICAgdGhpcy5udW1CeXRlc0FsbG9jYXRlZCArPSBzaXplO1xuICAgIGNvbnN0IG5ld0J1ZmZlciA9IHRoaXMuZGV2aWNlLmNyZWF0ZUJ1ZmZlcih7c2l6ZSwgdXNhZ2UsIG1hcHBlZEF0Q3JlYXRpb259KTtcbiAgICB0aGlzLnVzZWRCdWZmZXJzLmdldChrZXkpLnB1c2gobmV3QnVmZmVyKTtcblxuICAgIHJldHVybiBuZXdCdWZmZXI7XG4gIH1cblxuICByZWxlYXNlQnVmZmVyKGJ1ZmZlcjogR1BVQnVmZmVyLCBzaXplOiBudW1iZXIsIHVzYWdlOiBHUFVCdWZmZXJVc2FnZUZsYWdzKSB7XG4gICAgaWYgKHRoaXMuZnJlZUJ1ZmZlcnMuc2l6ZSA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGtleSA9IGdldEJ1ZmZlcktleShzaXplLCB1c2FnZSk7XG4gICAgaWYgKCF0aGlzLmZyZWVCdWZmZXJzLmhhcyhrZXkpKSB7XG4gICAgICB0aGlzLmZyZWVCdWZmZXJzLnNldChrZXksIFtdKTtcbiAgICB9XG5cbiAgICB0aGlzLmZyZWVCdWZmZXJzLmdldChrZXkpLnB1c2goYnVmZmVyKTtcbiAgICB0aGlzLm51bUZyZWVCdWZmZXJzKys7XG4gICAgdGhpcy5udW1Vc2VkQnVmZmVycy0tO1xuXG4gICAgY29uc3QgYnVmZmVyTGlzdCA9IHRoaXMudXNlZEJ1ZmZlcnMuZ2V0KGtleSk7XG4gICAgY29uc3QgYnVmZmVySW5kZXggPSBidWZmZXJMaXN0LmluZGV4T2YoYnVmZmVyKTtcbiAgICBpZiAoYnVmZmVySW5kZXggPCAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0Nhbm5vdCByZWxlYXNlIGEgYnVmZmVyIHRoYXQgd2FzIG5ldmVyIHByb3ZpZGVkIGJ5IHRoaXMgJyArXG4gICAgICAgICAgJ2J1ZmZlciBtYW5hZ2VyJyk7XG4gICAgfVxuICAgIGJ1ZmZlckxpc3Quc3BsaWNlKGJ1ZmZlckluZGV4LCAxKTtcbiAgICB0aGlzLm51bUJ5dGVzVXNlZCAtPSBzaXplO1xuICB9XG5cbiAgcmVsZWFzZVVwbG9hZEJ1ZmZlcihcbiAgICAgIGJ1ZmZlcjogR1BVQnVmZmVyLCBzaXplOiBudW1iZXIsIHVzYWdlOiBHUFVCdWZmZXJVc2FnZUZsYWdzKSB7XG4gICAgYnVmZmVyLm1hcEFzeW5jKEdQVU1hcE1vZGUuV1JJVEUpXG4gICAgICAgIC50aGVuKFxuICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICB0aGlzLnJlbGVhc2VCdWZmZXIoYnVmZmVyLCBzaXplLCB1c2FnZSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIERvIG5vdGhpbmc7XG4gICAgICAgICAgICB9KTtcbiAgfVxuXG4gIGdldE51bVVzZWRCdWZmZXJzKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMubnVtVXNlZEJ1ZmZlcnM7XG4gIH1cblxuICBnZXROdW1GcmVlQnVmZmVycygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLm51bUZyZWVCdWZmZXJzO1xuICB9XG5cbiAgZGlzcG9zZSgpIHtcbiAgICB0aGlzLmZyZWVCdWZmZXJzLmZvckVhY2goKGJ1ZmZlcnMsIGtleSkgPT4ge1xuICAgICAgYnVmZmVycy5mb3JFYWNoKGJ1ZmZlciA9PiB7XG4gICAgICAgIGJ1ZmZlci5kZXN0cm95KCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRoaXMudXNlZEJ1ZmZlcnMuZm9yRWFjaCgoYnVmZmVycywga2V5KSA9PiB7XG4gICAgICBidWZmZXJzLmZvckVhY2goYnVmZmVyID0+IHtcbiAgICAgICAgYnVmZmVyLmRlc3Ryb3koKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGhpcy5mcmVlQnVmZmVycyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLnVzZWRCdWZmZXJzID0gbmV3IE1hcCgpO1xuICAgIHRoaXMubnVtVXNlZEJ1ZmZlcnMgPSAwO1xuICAgIHRoaXMubnVtRnJlZUJ1ZmZlcnMgPSAwO1xuICAgIHRoaXMubnVtQnl0ZXNVc2VkID0gMDtcbiAgICB0aGlzLm51bUJ5dGVzQWxsb2NhdGVkID0gMDtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRCdWZmZXJLZXkoc2l6ZTogbnVtYmVyLCB1c2FnZTogR1BVQnVmZmVyVXNhZ2VGbGFncykge1xuICByZXR1cm4gYCR7c2l6ZX1fJHt1c2FnZX1gO1xufVxuIl19